import{A as c}from"./constants-Cio_5RR6.js";import{h as m}from"./headers-7jRSljoY.js";async function u(a){const n=localStorage.getItem("token");if(!n)throw new Error("No auth token found. Please log in.");try{const e=await fetch(c,{method:"POST",headers:m(n),body:JSON.stringify(a)});if(console.log("Create Listing Response:",e),!e.ok){const t=await e.json();throw console.error("Error Details:",t),new Error(`Failed to create listing: ${t.message||"Unknown error"}`)}const r=await e.json();return console.log("Parsed Response Data:",r),r}catch(e){throw console.error("Error in createListing:",e),e}}async function g(a){a.preventDefault();const n=a.target,e=document.querySelectorAll(".image-field"),r=Array.from(e).map(o=>{const l=o.querySelector("input[name='media-url']").value.trim(),d=o.querySelector("input[name='media-alt']").value.trim();return{url:l,alt:d||void 0}}).filter(o=>o.url),t=n.querySelector("input[name='endsAt']").value.trim(),i=t?new Date(`${t}:00`).toISOString():null,s={title:n.querySelector("input[name='title']").value.trim(),description:n.querySelector("textarea[name='description']").value.trim(),endsAt:i,media:r};console.log("Final Listing Data:",s);try{const o=await u(s);console.log("Created Listing:",o);const l=o.data?.id;if(l)alert("Listing created successfully!"),window.location.href=`/annonse/?id=${l}`;else throw new Error("Listing ID not found in the response.")}catch(o){console.error("Error creating listing:",o),alert(`Error creating listing: ${o.message}`)}}function p(){const a=document.getElementById("add-image"),n=document.getElementById("media-container");if(!a||!n){console.error("Error: Image fields initialization failed.");return}a.addEventListener("click",()=>{const e=document.createElement("div");e.className="image-field flex items-center gap-4 mb-2";const r=document.createElement("input");r.type="url",r.name="media-url",r.placeholder="Legg inn bilde url",r.className="border border-gray-300 rounded-md p-2 flex-grow";const t=document.createElement("input");t.type="text",t.name="media-alt",t.placeholder="Legg inn alt tekst",t.className="border border-gray-300 rounded-md p-2 flex-grow";const i=document.createElement("button");i.type="button",i.textContent="Fjern",i.className="text-red-500 hover:underline",i.addEventListener("click",()=>{n.removeChild(e)}),e.appendChild(r),e.appendChild(t),e.appendChild(i),n.appendChild(e)})}document.getElementById("create-listing-form").addEventListener("submit",g);p();
