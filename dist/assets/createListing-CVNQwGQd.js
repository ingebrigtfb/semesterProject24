import{A as d}from"./constants-Cio_5RR6.js";import{h as u}from"./headers-7jRSljoY.js";async function m(n){const t=localStorage.getItem("token");if(!t)throw new Error("No auth token found. Please log in.");try{const e=await fetch(d,{method:"POST",headers:u(t),body:JSON.stringify(n)});if(console.log("Create Listing Response:",e),!e.ok){const r=await e.json();throw console.error("Error Details:",r),new Error(`Failed to create listing: ${r.message||"Unknown error"}`)}const o=await e.json();return console.log("Parsed Response Data:",o),o}catch(e){throw console.error("Error in createListing:",e),e}}async function g(n){n.preventDefault();const t=n.target,e=document.querySelectorAll(".image-field"),o=Array.from(e).map(i=>{const s=i.querySelector("input[name='media-url']").value.trim(),c=i.querySelector("input[name='media-alt']").value.trim();return{url:s,alt:c||void 0}}).filter(i=>i.url),r=t.querySelector("input[name='endsAt']").value.trim(),a=r?new Date(`${r}:00`).toISOString():null,l={title:t.querySelector("input[name='title']").value.trim(),description:t.querySelector("textarea[name='description']").value.trim(),endsAt:a,media:o};console.log("Final Listing Data:",l);try{const i=await m(l);console.log("Created Listing:",i);const s=i.data?.id;if(s)alert("Listing created successfully!"),window.location.href=`/annonse/?id=${s}`;else throw new Error("Listing ID not found in the response.")}catch(i){console.error("Error creating listing:",i),alert(`Error creating listing: ${i.message}`)}}function f(){const n=document.getElementById("add-image"),t=document.getElementById("media-container");if(!n||!t){console.error("Error: Image fields initialization failed.");return}n.addEventListener("click",()=>{const e=document.createElement("div");e.className="image-field flex flex-col sm:flex-row sm:items-center gap-4 mb-2";const o=document.createElement("input");o.type="url",o.name="media-url",o.placeholder="Legg inn bilde url",o.className="border border-secondary rounded-md p-2 w-full sm:w-auto sm:flex-1 focus:ring-2 focus:ring-secondary focus:outline-none";const r=document.createElement("input");r.type="text",r.name="media-alt",r.placeholder="Legg inn alt tekst",r.className="border border-secondary rounded-md p-2 w-full sm:w-auto sm:flex-1 focus:ring-2 focus:ring-secondary focus:outline-none";const a=document.createElement("button");a.type="button",a.textContent="Fjern",a.className="text-red-500 hover:underline",a.addEventListener("click",()=>{t.removeChild(e)}),e.appendChild(o),e.appendChild(r),e.appendChild(a),t.appendChild(e)})}function p(){const n=document.getElementById("description"),t=document.getElementById("description-char-count");if(!n||!t){console.error("Description field or char count display not found.");return}n.addEventListener("input",()=>{const e=n.value.length;t.textContent=e,e>160?t.classList.add("text-red-500"):t.classList.remove("text-red-500")})}p();document.getElementById("create-listing-form").addEventListener("submit",g);f();
